# Flutter Automate - å¤šè¯­è¨€è‡ªåŠ¨åŒ–æ¡†æ¶æ¶æ„è®¾è®¡

## ğŸ¯ ç›®æ ‡

æ‰“é€ ä¸€ä¸ªè·¨è¯­è¨€çš„ Android è‡ªåŠ¨åŒ–æ¡†æ¶ï¼Œæ”¯æŒï¼š
- **JavaScript / TypeScript**
- **Python**
- **Dart (Flutter)**
- æœªæ¥å¯æ‰©å±•æ›´å¤šè¯­è¨€

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Flutter UI Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Script Editorâ”‚  â”‚  Log View   â”‚  â”‚ Task Managerâ”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    Flutter Method Channel
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Core Engine (Kotlin)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Script Engine Manager                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ JS Engine  â”‚ â”‚ Python Eng â”‚ â”‚ Dart Engineâ”‚            â”‚   â”‚
â”‚  â”‚  â”‚  (WASM)    â”‚ â”‚  (WASM)    â”‚ â”‚  (Native)  â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚        â”‚              â”‚              â”‚                    â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â”‚                       â”‚                                   â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚   â”‚
â”‚  â”‚              â”‚  Unified API    â”‚                          â”‚   â”‚
â”‚  â”‚              â”‚   (Bindings)    â”‚                          â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 Automation Core                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ Selector â”‚ â”‚  Actions â”‚ â”‚  Screen  â”‚ â”‚  Device  â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  Engine  â”‚ â”‚  Engine  â”‚ â”‚  Capture â”‚ â”‚  Control â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              Android Accessibility Service / Root Shell
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Android System                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”Œ WASM è¿è¡Œæ—¶æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  WASM Runtime Host                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Wasmer / WasmEdge                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚           WASI Interface                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ File System (sandbox)                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Network (controlled)                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Environment                           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚      Host Functions (Automation API)    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ ui_*     (UI æ“ä½œ)                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ device_* (è®¾å¤‡æ§åˆ¶)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ screen_* (å±å¹•æ“ä½œ)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ app_*    (åº”ç”¨ç®¡ç†)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ file_*   (æ–‡ä»¶æ“ä½œ)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ http_*   (ç½‘ç»œè¯·æ±‚)                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ QuickJS.wasmâ”‚ â”‚ Python.wasm â”‚ â”‚ Custom.wasm â”‚   â”‚
â”‚  â”‚ (JS/TS)     â”‚ â”‚ (Pyodide)   â”‚ â”‚ (Rust/Go)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ ¸å¿ƒ API è®¾è®¡

### 1. UI é€‰æ‹©å™¨ API

```typescript
// ================== Selector API ==================

interface Selector {
  // åŸºç¡€é€‰æ‹©å™¨
  text(value: string): Selector;
  textContains(value: string): Selector;
  textMatches(regex: string): Selector;
  textStartsWith(value: string): Selector;
  
  id(resourceId: string): Selector;
  idContains(value: string): Selector;
  idMatches(regex: string): Selector;
  
  className(name: string): Selector;
  classNameContains(value: string): Selector;
  
  description(desc: string): Selector;
  descContains(value: string): Selector;
  
  packageName(pkg: string): Selector;
  
  // å±æ€§é€‰æ‹©å™¨
  clickable(value?: boolean): Selector;
  scrollable(value?: boolean): Selector;
  editable(value?: boolean): Selector;
  enabled(value?: boolean): Selector;
  checked(value?: boolean): Selector;
  selected(value?: boolean): Selector;
  focusable(value?: boolean): Selector;
  focused(value?: boolean): Selector;
  
  // ä½ç½®é€‰æ‹©å™¨
  bounds(left: number, top: number, right: number, bottom: number): Selector;
  boundsInside(left: number, top: number, right: number, bottom: number): Selector;
  boundsContains(left: number, top: number, right: number, bottom: number): Selector;
  
  // å±‚çº§é€‰æ‹©å™¨
  depth(d: number): Selector;
  index(i: number): Selector;
  
  // å…³ç³»é€‰æ‹©å™¨
  parent(): Selector;
  child(selector: Selector): Selector;
  sibling(selector: Selector): Selector;
  ancestor(selector: Selector): Selector;
  descendant(selector: Selector): Selector;
  
  // æŸ¥æ‰¾æ–¹æ³•
  find(): UiObject | null;
  findAll(): UiObject[];
  findOne(timeout?: number): UiObject;
  waitFor(timeout?: number): UiObject;
  exists(): boolean;
  
  // ä¾¿æ·æ“ä½œ
  click(): boolean;
  longClick(): boolean;
  setText(text: string): boolean;
  scrollForward(): boolean;
  scrollBackward(): boolean;
}

// å…¨å±€é€‰æ‹©å™¨å…¥å£
function $(selector: string | SelectorBuilder): Selector;
function text(value: string): Selector;
function id(resourceId: string): Selector;
function className(name: string): Selector;
function desc(description: string): Selector;
```

### 2. UiObject API

```typescript
// ================== UiObject API ==================

interface UiObject {
  // å±æ€§è·å–
  text(): string;
  id(): string;
  className(): string;
  description(): string;
  packageName(): string;
  bounds(): Rect;
  depth(): number;
  indexInParent(): number;
  childCount(): number;
  
  // çŠ¶æ€æ£€æŸ¥
  isClickable(): boolean;
  isScrollable(): boolean;
  isEditable(): boolean;
  isEnabled(): boolean;
  isChecked(): boolean;
  isSelected(): boolean;
  isFocusable(): boolean;
  isFocused(): boolean;
  
  // æ“ä½œ
  click(): boolean;
  longClick(): boolean;
  doubleClick(): boolean;
  setText(text: string): boolean;
  paste(text: string): boolean;
  copy(): boolean;
  cut(): boolean;
  focus(): boolean;
  scrollForward(): boolean;
  scrollBackward(): boolean;
  scrollUp(): boolean;
  scrollDown(): boolean;
  scrollLeft(): boolean;
  scrollRight(): boolean;
  select(): boolean;
  collapse(): boolean;
  expand(): boolean;
  
  // å±‚çº§éå†
  parent(): UiObject | null;
  child(index: number): UiObject | null;
  children(): UiObject[];
  siblings(): UiObject[];
  find(selector: Selector): UiObject | null;
  findAll(selector: Selector): UiObject[];
}

interface Rect {
  left: number;
  top: number;
  right: number;
  bottom: number;
  width(): number;
  height(): number;
  centerX(): number;
  centerY(): number;
}
```

### 3. æ‰‹åŠ¿ä¸è¾“å…¥ API

```typescript
// ================== Gesture API ==================

interface Gesture {
  // åŸºç¡€æ‰‹åŠ¿
  click(x: number, y: number): boolean;
  longClick(x: number, y: number, duration?: number): boolean;
  doubleClick(x: number, y: number): boolean;
  
  // æ»‘åŠ¨
  swipe(x1: number, y1: number, x2: number, y2: number, duration?: number): boolean;
  swipeUp(y?: number, duration?: number): boolean;
  swipeDown(y?: number, duration?: number): boolean;
  swipeLeft(x?: number, duration?: number): boolean;
  swipeRight(x?: number, duration?: number): boolean;
  
  // æ‹–æ‹½
  drag(x1: number, y1: number, x2: number, y2: number, duration?: number): boolean;
  
  // å¤æ‚æ‰‹åŠ¿
  pinchIn(centerX: number, centerY: number, percent: number): boolean;
  pinchOut(centerX: number, centerY: number, percent: number): boolean;
  
  // è‡ªå®šä¹‰æ‰‹åŠ¿
  gesture(duration: number, ...points: [number, number][]): boolean;
  gestures(...gestures: GestureDescription[]): boolean;
}

interface GestureDescription {
  start: [number, number];
  end: [number, number];
  duration: number;
  delay?: number;
}

// ================== Input API ==================

interface Input {
  // æ–‡æœ¬è¾“å…¥
  text(content: string): boolean;
  
  // æŒ‰é”®
  keyEvent(keyCode: number): boolean;
  keyDown(keyCode: number): boolean;
  keyUp(keyCode: number): boolean;
  
  // ç»„åˆé”®
  hotkey(...keyCodes: number[]): boolean;
  
  // å¸¸ç”¨æŒ‰é”®
  back(): boolean;
  home(): boolean;
  recents(): boolean;
  notifications(): boolean;
  quickSettings(): boolean;
  powerDialog(): boolean;
  splitScreen(): boolean;
  screenshot(): boolean;
}

// å…¨å±€å®ä¾‹
const gesture: Gesture;
const input: Input;
```

### 4. å±å¹• API

```typescript
// ================== Screen API ==================

interface Screen {
  // åŸºç¡€ä¿¡æ¯
  width(): number;
  height(): number;
  density(): number;
  rotation(): number; // 0, 90, 180, 270
  
  // æˆªå›¾
  capture(): Image;
  captureRegion(x: number, y: number, width: number, height: number): Image;
  
  // å½•å±
  startRecord(path: string, options?: RecordOptions): void;
  stopRecord(): string; // è¿”å›æ–‡ä»¶è·¯å¾„
  isRecording(): boolean;
  
  // äº®åº¦
  brightness(): number;
  setBrightness(level: number): void; // 0-255
  
  // å±å¹•çŠ¶æ€
  isOn(): boolean;
  turnOn(): void;
  turnOff(): void;
  
  // é”å±
  isLocked(): boolean;
  lock(): void;
  unlock(password?: string): boolean;
}

interface RecordOptions {
  width?: number;
  height?: number;
  bitrate?: number;
  fps?: number;
}
```

### 5. å›¾åƒå¤„ç† API

```typescript
// ================== Image API ==================

interface Image {
  // åŸºç¡€ä¿¡æ¯
  width(): number;
  height(): number;
  
  // åƒç´ æ“ä½œ
  pixel(x: number, y: number): Color;
  
  // å›¾åƒå¤„ç†
  resize(width: number, height: number): Image;
  crop(x: number, y: number, width: number, height: number): Image;
  rotate(degrees: number): Image;
  grayscale(): Image;
  threshold(value: number): Image;
  blur(radius: number): Image;
  
  // ä¿å­˜
  save(path: string, format?: 'png' | 'jpg', quality?: number): boolean;
  toBase64(): string;
  toBytes(): Uint8Array;
  
  // é‡Šæ”¾
  recycle(): void;
}

interface Color {
  r: number;
  g: number;
  b: number;
  a: number;
  toHex(): string;
  toInt(): number;
}

// ================== OCR API ==================

interface OCR {
  // æ–‡å­—è¯†åˆ«
  recognize(image: Image, language?: string): OcrResult;
  recognizeRegion(image: Image, x: number, y: number, w: number, h: number): OcrResult;
  
  // æ‰¾æ–‡å­—
  findText(image: Image, text: string): Point[];
}

interface OcrResult {
  text: string;
  words: OcrWord[];
}

interface OcrWord {
  text: string;
  confidence: number;
  bounds: Rect;
}

// ================== æ‰¾å›¾æ‰¾è‰² ==================

interface ImageFinder {
  // æ‰¾å›¾
  findImage(source: Image, template: Image, options?: FindImageOptions): Point | null;
  findAllImages(source: Image, template: Image, options?: FindImageOptions): Point[];
  matchTemplate(source: Image, template: Image): MatchResult;
  
  // æ‰¾è‰²
  findColor(image: Image, color: Color | number, options?: FindColorOptions): Point | null;
  findAllColors(image: Image, color: Color | number, options?: FindColorOptions): Point[];
  findMultiColors(image: Image, firstColor: number, colorOffsets: [number, number, number][]): Point | null;
}

interface FindImageOptions {
  threshold?: number;  // ç›¸ä¼¼åº¦é˜ˆå€¼ 0-1
  region?: [number, number, number, number]; // æœç´¢åŒºåŸŸ
  scale?: number[];    // ç¼©æ”¾æ¯”ä¾‹
}

interface FindColorOptions {
  threshold?: number;  // é¢œè‰²å®¹å·®
  region?: [number, number, number, number];
}
```

### 6. åº”ç”¨ç®¡ç† API

```typescript
// ================== App API ==================

interface App {
  // å¯åŠ¨åº”ç”¨
  launch(packageName: string): boolean;
  launchActivity(packageName: string, activityName: string): boolean;
  launchByName(appName: string): boolean;
  
  // åº”ç”¨ä¿¡æ¯
  getPackageName(appName: string): string | null;
  getAppName(packageName: string): string | null;
  getInstalledApps(): AppInfo[];
  getAppInfo(packageName: string): AppInfo | null;
  
  // åº”ç”¨æ§åˆ¶
  killApp(packageName: string): boolean;
  forceStop(packageName: string): boolean;
  clearData(packageName: string): boolean;
  
  // å®‰è£…å¸è½½
  install(apkPath: string): boolean;
  uninstall(packageName: string): boolean;
  
  // å½“å‰åº”ç”¨
  currentPackage(): string;
  currentActivity(): string;
  
  // æ„å›¾
  startIntent(intent: Intent): boolean;
  sendBroadcast(intent: Intent): boolean;
  
  // æ‰“å¼€ç³»ç»Ÿé¡µé¢
  openSettings(): void;
  openAppSettings(packageName: string): void;
  openUrl(url: string): void;
}

interface AppInfo {
  packageName: string;
  appName: string;
  versionName: string;
  versionCode: number;
  isSystemApp: boolean;
  icon: Image;
}

interface Intent {
  action?: string;
  data?: string;
  type?: string;
  packageName?: string;
  className?: string;
  extras?: Record<string, any>;
  flags?: number[];
}
```

### 7. è®¾å¤‡ API

```typescript
// ================== Device API ==================

interface Device {
  // è®¾å¤‡ä¿¡æ¯
  model: string;
  brand: string;
  manufacturer: string;
  product: string;
  device: string;
  board: string;
  hardware: string;
  serial: string;
  androidId: string;
  
  // ç³»ç»Ÿä¿¡æ¯
  sdkVersion: number;
  androidVersion: string;
  buildId: string;
  fingerprint: string;
  
  // å±å¹•ä¿¡æ¯
  screenWidth: number;
  screenHeight: number;
  screenDensity: number;
  
  // ç”µæ± 
  battery(): number;
  isCharging(): boolean;
  
  // ç½‘ç»œ
  isConnected(): boolean;
  networkType(): 'wifi' | 'mobile' | 'none';
  wifiName(): string | null;
  ipAddress(): string;
  macAddress(): string;
  
  // éŸ³é‡
  getVolume(stream?: 'music' | 'ring' | 'notification' | 'alarm'): number;
  setVolume(level: number, stream?: string): void;
  
  // å‰ªè´´æ¿
  getClipboard(): string;
  setClipboard(text: string): void;
  
  // éœ‡åŠ¨
  vibrate(milliseconds: number): void;
  vibratePattern(pattern: number[]): void;
  cancelVibration(): void;
  
  // ä¼ æ„Ÿå™¨
  onSensorChanged(type: SensorType, callback: (values: number[]) => void): void;
  
  // Root
  isRooted(): boolean;
  rootExec(command: string): ShellResult;
  
  // æ— éšœç¢
  isAccessibilityEnabled(): boolean;
  requestAccessibility(): Promise<boolean>;
}

type SensorType = 'accelerometer' | 'gyroscope' | 'magnetometer' | 'light' | 'proximity';

interface ShellResult {
  code: number;
  output: string;
  error: string;
}
```

### 8. æ–‡ä»¶ç³»ç»Ÿ API

```typescript
// ================== File System API ==================

interface FileSystem {
  // è¯»å†™
  read(path: string, encoding?: string): string;
  readBytes(path: string): Uint8Array;
  write(path: string, content: string, encoding?: string): void;
  writeBytes(path: string, bytes: Uint8Array): void;
  append(path: string, content: string): void;
  
  // æ–‡ä»¶æ“ä½œ
  exists(path: string): boolean;
  isFile(path: string): boolean;
  isDir(path: string): boolean;
  mkdir(path: string): boolean;
  mkdirs(path: string): boolean;
  remove(path: string): boolean;
  removeDir(path: string): boolean;
  copy(src: string, dest: string): boolean;
  move(src: string, dest: string): boolean;
  rename(path: string, newName: string): boolean;
  
  // ç›®å½•
  list(path: string): string[];
  listFiles(path: string, filter?: (name: string) => boolean): FileInfo[];
  
  // è·¯å¾„
  join(...parts: string[]): string;
  dirname(path: string): string;
  basename(path: string): string;
  extname(path: string): string;
  
  // ç‰¹æ®Šç›®å½•
  cwd(): string;
  home(): string;
  sdcard(): string;
  external(): string;
}

interface FileInfo {
  name: string;
  path: string;
  size: number;
  isFile: boolean;
  isDir: boolean;
  lastModified: number;
}
```

### 9. ç½‘ç»œ API

```typescript
// ================== HTTP API ==================

interface Http {
  // è¯·æ±‚æ–¹æ³•
  get(url: string, options?: RequestOptions): Response;
  post(url: string, body?: any, options?: RequestOptions): Response;
  put(url: string, body?: any, options?: RequestOptions): Response;
  delete(url: string, options?: RequestOptions): Response;
  patch(url: string, body?: any, options?: RequestOptions): Response;
  
  // é€šç”¨è¯·æ±‚
  request(url: string, options?: RequestOptions): Response;
  
  // æ–‡ä»¶ä¸‹è½½ä¸Šä¼ 
  download(url: string, savePath: string, options?: DownloadOptions): void;
  upload(url: string, filePath: string, options?: UploadOptions): Response;
}

interface RequestOptions {
  method?: string;
  headers?: Record<string, string>;
  body?: any;
  json?: any;
  form?: Record<string, string>;
  timeout?: number;
  followRedirects?: boolean;
}

interface Response {
  status: number;
  statusText: string;
  headers: Record<string, string>;
  body: string;
  json(): any;
  bytes(): Uint8Array;
}

interface DownloadOptions extends RequestOptions {
  onProgress?: (downloaded: number, total: number) => void;
}

// ================== WebSocket API ==================

interface WebSocket {
  connect(url: string, options?: WebSocketOptions): WebSocketConnection;
}

interface WebSocketConnection {
  send(message: string | Uint8Array): void;
  close(code?: number, reason?: string): void;
  onOpen(callback: () => void): void;
  onMessage(callback: (message: string) => void): void;
  onError(callback: (error: Error) => void): void;
  onClose(callback: (code: number, reason: string) => void): void;
}
```

### 10. æ§åˆ¶æµ API

```typescript
// ================== Control API ==================

// ç­‰å¾…
function sleep(milliseconds: number): void;
function wait(condition: () => boolean, timeout?: number, interval?: number): boolean;

// å®šæ—¶å™¨
function setInterval(callback: () => void, interval: number): number;
function setTimeout(callback: () => void, delay: number): number;
function clearInterval(id: number): void;
function clearTimeout(id: number): void;

// çº¿ç¨‹
interface Thread {
  start(func: () => void): ThreadHandle;
  currentId(): number;
}

interface ThreadHandle {
  id: number;
  join(timeout?: number): void;
  interrupt(): void;
  isAlive(): boolean;
}

// äº‹ä»¶
interface Events {
  on(event: string, callback: (...args: any[]) => void): void;
  off(event: string, callback?: (...args: any[]) => void): void;
  once(event: string, callback: (...args: any[]) => void): void;
  emit(event: string, ...args: any[]): void;
  
  // ç³»ç»Ÿäº‹ä»¶
  onKeyDown(callback: (keyCode: number) => void): void;
  onKeyUp(callback: (keyCode: number) => void): void;
  onTouch(callback: (x: number, y: number, action: string) => void): void;
  onNotification(callback: (notification: Notification) => void): void;
  onToast(callback: (text: string, packageName: string) => void): void;
}

// æ—¥å¿—
interface Console {
  log(...args: any[]): void;
  info(...args: any[]): void;
  warn(...args: any[]): void;
  error(...args: any[]): void;
  debug(...args: any[]): void;
  verbose(...args: any[]): void;
  assert(condition: boolean, ...args: any[]): void;
  clear(): void;
  time(label: string): void;
  timeEnd(label: string): void;
  trace(): void;
}

const console: Console;
```

## ğŸ§© WASM Host Function ç»‘å®š

```kotlin
// Kotlin ä¾§çš„ WASM Host Function æ³¨å†Œ

class AutomationHostFunctions(private val runtime: WasmRuntime) {
    
    init {
        // UI æ“ä½œ
        runtime.registerHostFunction("ui_find") { args -> uiFind(args) }
        runtime.registerHostFunction("ui_click") { args -> uiClick(args) }
        runtime.registerHostFunction("ui_set_text") { args -> uiSetText(args) }
        runtime.registerHostFunction("ui_wait_for") { args -> uiWaitFor(args) }
        
        // æ‰‹åŠ¿
        runtime.registerHostFunction("gesture_click") { args -> gestureClick(args) }
        runtime.registerHostFunction("gesture_swipe") { args -> gestureSwipe(args) }
        runtime.registerHostFunction("gesture_drag") { args -> gestureDrag(args) }
        
        // å±å¹•
        runtime.registerHostFunction("screen_capture") { args -> screenCapture(args) }
        runtime.registerHostFunction("screen_info") { args -> screenInfo(args) }
        
        // å›¾åƒ
        runtime.registerHostFunction("image_find") { args -> imageFind(args) }
        runtime.registerHostFunction("image_find_color") { args -> imageFindColor(args) }
        runtime.registerHostFunction("image_ocr") { args -> imageOcr(args) }
        
        // åº”ç”¨
        runtime.registerHostFunction("app_launch") { args -> appLaunch(args) }
        runtime.registerHostFunction("app_current") { args -> appCurrent(args) }
        runtime.registerHostFunction("app_kill") { args -> appKill(args) }
        
        // è®¾å¤‡
        runtime.registerHostFunction("device_info") { args -> deviceInfo(args) }
        runtime.registerHostFunction("device_clipboard_get") { args -> clipboardGet(args) }
        runtime.registerHostFunction("device_clipboard_set") { args -> clipboardSet(args) }
        
        // è¾“å…¥
        runtime.registerHostFunction("input_text") { args -> inputText(args) }
        runtime.registerHostFunction("input_key") { args -> inputKey(args) }
        runtime.registerHostFunction("input_back") { args -> inputBack(args) }
        runtime.registerHostFunction("input_home") { args -> inputHome(args) }
        
        // æ–‡ä»¶ç³»ç»Ÿ
        runtime.registerHostFunction("fs_read") { args -> fsRead(args) }
        runtime.registerHostFunction("fs_write") { args -> fsWrite(args) }
        runtime.registerHostFunction("fs_exists") { args -> fsExists(args) }
        runtime.registerHostFunction("fs_list") { args -> fsList(args) }
        
        // ç½‘ç»œ
        runtime.registerHostFunction("http_request") { args -> httpRequest(args) }
        
        // æ§åˆ¶æµ
        runtime.registerHostFunction("sleep") { args -> sleep(args) }
        runtime.registerHostFunction("log") { args -> log(args) }
    }
}
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
flutter_automate/
â”œâ”€â”€ lib/                           # Flutter Dart ä»£ç 
â”‚   â”œâ”€â”€ flutter_automate.dart      # ä¸»å…¥å£
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/                   # Dart API å°è£…
â”‚   â”‚   â”œâ”€â”€ ui/                    # UI ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ editor/            # ä»£ç ç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ logview/           # æ—¥å¿—è§†å›¾
â”‚   â”‚   â”‚   â””â”€â”€ task_manager/      # ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â””â”€â”€ models/                # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ widgets/
â”‚
â”œâ”€â”€ android/
â”‚   â””â”€â”€ src/main/kotlin/im/zoe/flutter_automate/
â”‚       â”œâ”€â”€ FlutterAutomatePlugin.kt
â”‚       â”œâ”€â”€ core/
â”‚       â”‚   â”œâ”€â”€ AutomationCore.kt          # æ ¸å¿ƒè‡ªåŠ¨åŒ–å¼•æ“
â”‚       â”‚   â”œâ”€â”€ AccessibilityEngine.kt     # æ— éšœç¢æœåŠ¡å°è£…
â”‚       â”‚   â”œâ”€â”€ GestureEngine.kt           # æ‰‹åŠ¿å¼•æ“
â”‚       â”‚   â”œâ”€â”€ ScreenEngine.kt            # å±å¹•æ“ä½œ
â”‚       â”‚   â””â”€â”€ ImageEngine.kt             # å›¾åƒå¤„ç†
â”‚       â”œâ”€â”€ wasm/
â”‚       â”‚   â”œâ”€â”€ WasmRuntime.kt             # WASM è¿è¡Œæ—¶ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ HostFunctions.kt           # Host Function ç»‘å®š
â”‚       â”‚   â”œâ”€â”€ MemoryManager.kt           # å†…å­˜ç®¡ç†
â”‚       â”‚   â””â”€â”€ engines/
â”‚       â”‚       â”œâ”€â”€ QuickJsEngine.kt       # JS/TS å¼•æ“
â”‚       â”‚       â”œâ”€â”€ PythonEngine.kt        # Python å¼•æ“
â”‚       â”‚       â””â”€â”€ BaseWasmEngine.kt      # åŸºç±»
â”‚       â”œâ”€â”€ api/
â”‚       â”‚   â”œâ”€â”€ UiApi.kt
â”‚       â”‚   â”œâ”€â”€ GestureApi.kt
â”‚       â”‚   â”œâ”€â”€ ScreenApi.kt
â”‚       â”‚   â”œâ”€â”€ AppApi.kt
â”‚       â”‚   â”œâ”€â”€ DeviceApi.kt
â”‚       â”‚   â”œâ”€â”€ FileApi.kt
â”‚       â”‚   â””â”€â”€ HttpApi.kt
â”‚       â””â”€â”€ service/
â”‚           â””â”€â”€ AutomateAccessibilityService.kt
â”‚
â”œâ”€â”€ wasm/                          # WASM æ¨¡å—
â”‚   â”œâ”€â”€ quickjs/                   # QuickJS WASM æ„å»º
â”‚   â”œâ”€â”€ python/                    # Python (Pyodide) é›†æˆ
â”‚   â””â”€â”€ bindings/                  # è¯­è¨€ç»‘å®šç”Ÿæˆ
â”‚       â”œâ”€â”€ js/                    # JavaScript/TypeScript ç»‘å®š
â”‚       â”‚   â”œâ”€â”€ automate.d.ts      # TypeScript ç±»å‹å®šä¹‰
â”‚       â”‚   â””â”€â”€ automate.js        # JS API å°è£…
â”‚       â””â”€â”€ python/                # Python ç»‘å®š
â”‚           â””â”€â”€ automate.py        # Python API å°è£…
â”‚
â”œâ”€â”€ ios/                           # iOS æ”¯æŒ (å—é™)
â”œâ”€â”€ macos/                         # macOS æ”¯æŒ
â”‚
â”œâ”€â”€ example/                       # ç¤ºä¾‹é¡¹ç›®
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ hello.js
â”‚       â”œâ”€â”€ hello.ts
â”‚       â””â”€â”€ hello.py
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ ARCHITECTURE.md            # æœ¬æ–‡æ¡£
    â”œâ”€â”€ API.md                     # API å‚è€ƒ
    â””â”€â”€ CONTRIBUTING.md            # è´¡çŒ®æŒ‡å—
```

## ğŸš€ å®ç°è·¯çº¿å›¾

### Phase 1: åŸºç¡€é‡æ„ (2-3 weeks)
- [ ] é‡æ„ç°æœ‰ Kotlin ä»£ç ï¼ŒæŠ½è±¡å‡º AutomationCore
- [ ] å®šä¹‰ç»Ÿä¸€çš„ API æ¥å£å±‚
- [ ] è¿ç§»ç°æœ‰ JavaScript å¼•æ“åˆ°æ–°æ¶æ„

### Phase 2: WASM é›†æˆ (3-4 weeks)
- [ ] é›†æˆ Wasmer-Android æˆ– WasmEdge
- [ ] å®ç° Host Function ç»‘å®š
- [ ] é›†æˆ QuickJS WASM (æ›¿ä»£ Rhino)

### Phase 3: å¤šè¯­è¨€æ”¯æŒ (2-3 weeks)
- [ ] TypeScript æ”¯æŒ (QuickJS + tsc)
- [ ] Python æ”¯æŒ (Pyodide æˆ– RustPython)
- [ ] ç”Ÿæˆå„è¯­è¨€çš„ API ç»‘å®š

### Phase 4: å®Œå–„ä¸ä¼˜åŒ– (ongoing)
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] æ›´å¤šå¹³å°æ”¯æŒ (iOS/macOS)
- [ ] æ’ä»¶ç³»ç»Ÿ
- [ ] äº‘ç«¯è„šæœ¬å¸‚åœº

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **WASM æ€§èƒ½**: Android ä¸Š WASM æ€§èƒ½å¯èƒ½ä¸å¦‚åŸç”Ÿï¼Œéœ€è¦åšå¥½æ€§èƒ½æµ‹è¯•
2. **å†…å­˜ç®¡ç†**: WASM å’Œ Native ä¹‹é—´çš„æ•°æ®ä¼ é€’éœ€è¦æ³¨æ„å†…å­˜ç®¡ç†
3. **æƒé™**: è¾…åŠ©åŠŸèƒ½æœåŠ¡éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å¼€å¯
4. **å…¼å®¹æ€§**: ä¸åŒ Android ç‰ˆæœ¬çš„æ— éšœç¢ API æœ‰å·®å¼‚
5. **å®‰å…¨æ€§**: WASM æ²™ç®±éš”ç¦»è„šæœ¬æ‰§è¡Œç¯å¢ƒ
